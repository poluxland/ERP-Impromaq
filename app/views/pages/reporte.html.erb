<h1>Reporte Medidas <%= @year %></h1>

<hr>

<!-- ============================= -->
<!-- 1. STOCKS PROMEDIO MENSUALES -->
<!-- ============================= -->

<div class="row align-items-start">
  <!-- Gráfico -->
  <div class="col-md-9">
    <h2>Stocks promedio mensuales (<%= @year %>)</h2>

    <%= line_chart [
      { name: "Extra",    data: @stock_extra_prom },
      { name: "Especial", data: @stock_especial_prom },
      { name: "S3300",    data: @stock_s3300_prom },
      { name: "S4200",    data: @stock_s4200_prom },
      { name: "Total",    data: @stock_total_prom }
    ],
    xtitle: "Mes",
    ytitle: "Stock promedio (Ton)",
    curve: false,
    points: true %>
  </div>

  <!-- Tabla pequeña -->
  <div class="col-md-3">
    <h3 style="font-size: 1.1rem;">Promedio anual (<%= @year %>)</h3>

    <table class="table table-sm table-bordered" style="">
      <thead>
        <tr>
          <th>Producto</th>
          <th>Prom.</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Extra</td>
          <td><%= number_with_precision(@stock_extra_prom.values.sum.to_f / [@stock_extra_prom.size, 1].max, precision: 0) %></td>
        </tr>
        <tr>
          <td>Especial</td>
          <td><%= number_with_precision(@stock_especial_prom.values.sum.to_f / [@stock_especial_prom.size, 1].max, precision: 0) %></td>
        </tr>
        <tr>
          <td>S3300</td>
          <td><%= number_with_precision(@stock_s3300_prom.values.sum.to_f / [@stock_s3300_prom.size, 1].max, precision: 0) %></td>
        </tr>
        <tr>
          <td>S4200</td>
          <td><%= number_with_precision(@stock_s4200_prom.values.sum.to_f / [@stock_s4200_prom.size, 1].max, precision: 0) %></td>
        </tr>
        <tr>
          <td>Total</td>
          <td><%= number_with_precision(@stock_total_prom.values.sum.to_f / [@stock_total_prom.size, 1].max, precision: 0) %></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>


<br>



<!-- ========================================= -->
<!-- 2. PRODUCCIÓN MENSUAL POR EQUIPO        -->
<!-- ========================================= -->

<h2>Producción mensual total por equipo (<%= @year %>)</h2>

<%= column_chart [
  { name: "Haver",     data: @prodhaver_month },
  { name: "Ventomatic", data: @prodvento_month },
  { name: "Bigbag",    data: @prodbb_month }
],
xtitle: "Mes",
ytitle: "Producción promedio (unid/turno)",
legend: true %>

<hr>

<!-- ========================================= -->
<!-- 3. HORAS DE FUNCIONAMIENTO MENSUALES     -->
<!-- ========================================= -->

<h2>Horas de funcionamiento mensuales por equipo</h2>

<%= column_chart [
  { name: "Haver",     data: @horas_haver_month },
  { name: "Ventomatic", data: @horas_vento_month },
  { name: "Bigbag",    data: @horas_bigbag_month }
],
xtitle: "Mes",
ytitle: "Horas",
legend: true %>

<hr>

<!-- ============================== -->
<!-- 4. DESPACHOS TOTALES MENSUALES -->
<!-- ============================== -->

<h2>Despachos totales mensuales</h2>

<%= column_chart [
  { name: "Especial sacos",   data: @desp_especial_sacos_month },
  { name: "Extra sacos",      data: @desp_extra_sacos_month },
  { name: "Especial Bigbag",  data: @desp_especial_bigbag_month },
  { name: "Extra Bigbag",     data: @desp_extra_bigbag_month },
  { name: "Especial granel",  data: @desp_especial_granel_month },
  { name: "Extra granel",     data: @desp_extra_granel_month },
  { name: "S3300 granel",     data: @desp_s3300_granel_month },
  { name: "S4200 granel",     data: @desp_s4200_granel_month }
],
stacked: true,
xtitle: "Mes",
ytitle: "Ton despachadas" %>

<br>

<h3>Despachos totales año <%= @year %> (Ton)</h3>

<table class="table table-sm table-bordered">
  <thead>
    <tr>
      <th>Producto</th>
      <th>Toneladas despachadas</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Especial sacos</td>
      <td><%= @desp_especial_sacos_month.values.sum %></td>
    </tr>
    <tr>
      <td>Extra sacos</td>
      <td><%= @desp_extra_sacos_month.values.sum %></td>
    </tr>
    <tr>
      <td>Especial Bigbag</td>
      <td><%= @desp_especial_bigbag_month.values.sum %></td>
    </tr>
    <tr>
      <td>Extra Bigbag</td>
      <td><%= @desp_extra_bigbag_month.values.sum %></td>
    </tr>
    <tr>
      <td>Especial granel</td>
      <td><%= @desp_especial_granel_month.values.sum %></td>
    </tr>
    <tr>
      <td>Extra granel</td>
      <td><%= @desp_extra_granel_month.values.sum %></td>
    </tr>
    <tr>
      <td>S3300 granel</td>
      <td><%= @desp_s3300_granel_month.values.sum %></td>
    </tr>
    <tr>
      <td>S4200 granel</td>
      <td><%= @desp_s4200_granel_month.values.sum %></td>
    </tr>
  </tbody>
</table>

<hr>

<!-- ================================= -->
<!-- 5. PRODUCCIÓN DIARIA POR EQUIPO   -->
<!-- ================================= -->

<h2>Producción diaria por equipo y turno</h2>

<div class="row">
  <div class="col-md-4">
    <h3>Haver</h3>
    <%= line_chart [
      { name: "TM", data: @prodhaver_tm, color: "#FF5733" },
      { name: "TT", data: @prodhaver_tt, color: "#33FF57" },
      { name: "TN", data: @prodhaver_tn, color: "#3357FF" }
    ],
    xtitle: "Fecha",
    ytitle: "Prod. Haver",
    curve: false,
    points: true %>

    <table class="table table-sm table-bordered mt-2">
      <thead>
        <tr>
          <th>Turno</th>
          <th>Promedio</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>TM</td>
          <td><%= number_with_precision(@prodhaver_avg_tm || 0, precision: 2) %></td>
        </tr>
        <tr>
          <td>TT</td>
          <td><%= number_with_precision(@prodhaver_avg_tt || 0, precision: 2) %></td>
        </tr>
        <tr>
          <td>TN</td>
          <td><%= number_with_precision(@prodhaver_avg_tn || 0, precision: 2) %></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="col-md-4">
    <h3>Ventomatic</h3>
    <%= line_chart [
      { name: "TM", data: @prodvento_tm },
      { name: "TT", data: @prodvento_tt },
      { name: "TN", data: @prodvento_tn }
    ],
    xtitle: "Fecha",
    ytitle: "Prod. Vento",
    curve: false,
    points: true %>

    <table class="table table-sm table-bordered mt-2">
      <thead>
        <tr>
          <th>Turno</th>
          <th>Promedio</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>TM</td>
          <td><%= number_with_precision(@prodvento_avg_tm || 0, precision: 2) %></td>
        </tr>
        <tr>
          <td>TT</td>
          <td><%= number_with_precision(@prodvento_avg_tt || 0, precision: 2) %></td>
        </tr>
        <tr>
          <td>TN</td>
          <td><%= number_with_precision(@prodvento_avg_tn || 0, precision: 2) %></td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="col-md-4">
    <h3>Bigbag</h3>
    <%= line_chart [
      { name: "TM", data: @prodbb_tm },
      { name: "TT", data: @prodbb_tt },
      { name: "TN", data: @prodbb_tn }
    ],
    xtitle: "Fecha",
    ytitle: "Prod. Bigbag",
    curve: false,
    points: true %>

    <table class="table table-sm table-bordered mt-2">
      <thead>
        <tr>
          <th>Turno</th>
          <th>Promedio</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>TM</td>
          <td><%= number_with_precision(@prodbb_avg_tm || 0, precision: 2) %></td>
        </tr>
        <tr>
          <td>TT</td>
          <td><%= number_with_precision(@prodbb_avg_tt || 0, precision: 2) %></td>
        </tr>
        <tr>
          <td>TN</td>
          <td><%= number_with_precision(@prodbb_avg_tn || 0, precision: 2) %></td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<hr>

<!-- ====================== -->
<!-- 6. ENVASADORA          -->
<!-- ====================== -->

<h2>Envasadora</h2>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>Campo</th>
      <th>Último Valor</th>
      <th>Promedio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Especial Sacos</td>
      <td><%= @ultimo_especialsacos %></td>
      <td><%= number_with_precision(@promedio_especialsacos || 0, precision: 2) %></td>
    </tr>
    <tr>
      <td>Bigbag Extra</td>
      <td><%= @ultimo_bigbagextra %></td>
      <td><%= number_with_precision(@promedio_bigbagextra || 0, precision: 2) %></td>
    </tr>
    <tr>
      <td>Extra Sacos</td>
      <td><%= @ultimo_extrsacos %></td>
      <td><%= number_with_precision(@promedio_extrsacos || 0, precision: 2) %></td>
    </tr>
  </tbody>
</table>
