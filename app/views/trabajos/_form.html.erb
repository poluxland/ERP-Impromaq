
<%= simple_form_for(@trabajo)  do |f| %>
<%= f.error_notification %>
<%= f.error_notification message: f.object.errors[:base].to_sentence if f.object.errors[:base].present? %>

<div class="invoice-box">
  <table cellpadding="0" cellspacing="0">
    <tr class="top">
      <td colspan="4">
        <table>
          <tr><td class="title"><img src="/logo.png" style="width:100%; max-width:80px;"></td>
            <td></td></tr>
        </table>
      </td>
    </tr>
    <tr class="information">
      <td colspan="4">
        <table>
          <tr>
            <td>Servicios Industriales Impromaq Ltda<br> Viana 345 depto 14<br> Viña del Mar</td>
            <td>Impromaq Ltda.<br> Fernando Gonzalez<br>fernando.gonzalez@msindustria.cl</td>
          </tr>
        </table>
      </td>
    </tr>
    <tr class="heading">
      <td>Planta</td>
      <td>Solicita</td>
      <td>Centro de costo</td>
      <td>Cotiza</td>
    </tr>

    <tr>
      <td><%= f.input :planta, label: false, collection: [ "La Calera", "Ventanas", "P.Montt", "P.Arenas"] %></td>
      <td><%= f.input :ito, label: false %></td>
      <td><%= f.input :centro_costo, label: false, collection: [ "Cmec", "Horno", "Ser", "Trans", "Env", "Vts", "Ext Vts", "Adm", "Ptm", "Ext Ptm", "Ngp", "PUQ", "Otro"] %></td>
      <td><%= f.input :supervisor, label: false %></td>
    </tr>
    <tr class="heading">
      <td>Termino</td>
      <td>Estado</td>
      <td>OP</td>
      <td>Factura</td>
    </tr>
    <tr class>
        <td><%= f.input :fecha_termino, label: false, discard_year: true, discard_day: true, order: [:month] %></td>
        <td><%= f.input :avance, label: false, collection: ["Cotizada", "Aprobada", "En ejecucción", "Terminado", "Facturado", "Cancelada"] %></td>
        <td><%= f.input :op, label: false %></td>
        <td><%= f.input :factura, label: false %></td>
    </tr>
    <tr class="heading"><td colspan="4">Nombre cotización</td></tr>
    <tr><td colspan="4"><%= f.input :descripcion, label: false %></td></tr>
    </table>
    <table>
    <tr class="heading">
      <td>Descripción</td>
      <td>Cantidad</td>
      <td>Precio unitario</td>
      <td>Subtotal</td>
    </tr>
    <tr class="item">
      <td style="width: 50%;"><%= f.input :i1, label: false %></td>

      <td style="text-align: right;"><%= f.input :q1, label: false %></td>
      <td style="text-align: right;"><%= f.input :v1, label: false %></td>
      <td style="width: 20%;"> $0</td>
    </tr>
    <tr class="item">
      <td><%= f.input :i2, label: false %></td>

      <td style="text-align: right;"><%= f.input :q2, label: false %></td>
      <td style="text-align: right;"><%= f.input :v2, label: false %></td>
      <td>$0</td>
    </tr>
    <tr class="item">
      <td><%= f.input :i3, label: false %></td>

      <td style="text-align: right;"><%= f.input :q3, label: false %></td>
      <td style="text-align: right;"><%= f.input :v3, label: false %></td>
      <td>$0</td>
    </tr>
    <tr class="item">
      <td><%= f.input :i4, label: false %></td>

      <td style="text-align: right;"><%= f.input :q4, label: false %></td>
      <td style="text-align: right;"><%= f.input :v4, label: false %></td>
      <td>$0</td>
    </tr>
    <tr class="item">
      <td><%= f.input :i5, label: false %></td>

      <td style="text-align: right;"><%= f.input :q5, label: false %></td>
      <td style="text-align: right;"><%= f.input :v5, label: false %></td>
      <td>$0</td>
    </tr>
    <tr class="item">
      <td><%= f.input :i6, label: false %></td>

      <td style="text-align: right;"><%= f.input :q6, label: false %></td>
      <td style="text-align: right;"><%= f.input :v6, label: false %></td>
      <td>$0</td>
    </tr>
    <tr class="item">
      <td><%= f.input :i7, label: false %></td>

      <td style="text-align: right;"><%= f.input :q7, label: false %></td>
      <td style="text-align: right;"><%= f.input :v7, label: false %></td>
      <td>$0</td>
    </tr>
    <tr class="item">
      <td><%= f.input :i8, label: false %></td>

      <td style="text-align: right;"><%= f.input :q8, label: false %></td>
      <td style="text-align: right;"><%= f.input :v8, label: false %></td>
      <td>$0</td>
    </tr>
    <tr class="item">
      <td><%= f.input :i9, label: false %></td>

      <td style="text-align: right;"><%= f.input :q9, label: false %></td>
      <td style="text-align: right;"><%= f.input :v9, label: false %></td>
      <td>$0</td>
    </tr>
    <tr class="item">
      <td><%= f.input :i10, label: false %></td>

      <td style="text-align: right;"><%= f.input :q10, label: false %></td>
      <td style="text-align: right;"><%= f.input :v10, label: false %></td>
      <td>$0</td>
    </tr>
    <tr class="item">
      <td><%= f.input :i11, label: false %></td>

      <td style="text-align: right;"><%= f.input :q11, label: false %></td>
      <td style="text-align: right;"><%= f.input :v11, label: false %></td>
      <td>$0</td>
    </tr>
    <tr class="item">
      <td><%= f.input :i12, label: false %></td>

      <td style="text-align: right;"><%= f.input :q12, label: false %></td>
<td style="text-align: right;"><%= f.input :v12, label: false %></td>

      <td>$0</td>
    </tr>
    <tr class="total">
    <td colspan="3"></td>
    <td>Total: $0</td>
    </tr>
    <tr class="heading"><td colspan="4">Observaciones</td></tr>
    <tr class="details">
    <td colspan="3"><%= f.input :observaciones, label: false %></td>
    </tr>

  </table>
  <div class="botones">
  <%= f.button :submit, class: "btn btn-primary shadow", value: "Crear cotización" %>
</div>
</div>

<br>

<% end %>




<script>
  $('table').on('mouseup keyup', 'input[type=number]', () => calculateTotals());


  function calculateTotals() {
    const subtotals = $('.item').map((idx, val) => calculateSubtotal(val)).get();
    const total = subtotals.reduce((a, v) => a + Number(v), 0);
    $('.total td:eq(1)').text(formatAsCurrency(total));
  }

  function calculateSubtotal(row) {
    const $row = $(row);
    const inputs = $row.find('input');
    const subtotal = inputs[1].value * inputs[2].value;

    $row.find('td:last').text(formatAsCurrency(subtotal));

    return subtotal;
  }

  function formatAsCurrency(amount) {
    return `$${Intl.NumberFormat('de-DE').format(amount)}`;
}



</script>
